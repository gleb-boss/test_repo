Тут постараюсь собрать основные моменты, которые могут пригодиться на CTF в формате King of the Hill. Основная цель - положить файлик index.html в корневую директорию сайта с названием команды ( в том году так было). Все будет в формате рекомендаций.

Как это выглядит:

Есть IP адреса с сервисами, задача проэксплуатировать уязвимости в сервисах, попасть на машину, желательно закрепиться на ней ( на случай если вас кто-то выкинул вы смогли вернуться обратно ), повысить привилегии если необходимо и положить файлик index.html в корень веб-приложения. Очки начисляются за владение машиной, т.е пока ваш файл лежит в корне веб-приложения - очки капают.

1. Это сканирование портов ( если не выдадут информацию об этом )
Тут все по классике - nmap
`nmap -Pn -n -sC -sV <ip> -p-`  , если же сканирование будет долгим, можно сначала пройтись такой командой `nmap --min-rate 500 <ip> -p-` , а затем первую команду по найденным портам.

После определения сервисов, если nmap сможет определить версии, то есть смысл поискать уязвимости на эти версии.
Можно использовать команду `searchsploit <service + version>` - эта команда ищет эксплоиты в базе данных с сайта https://www.exploit-db.com. Если что-то найдется, скорее всего это можно эксплуатировать через Metasploit
Но это нечасто приносит плоды, тогда погуглить сервис с версией ( со словами exploit, vulnerability, attack и т.д).

P.S Возможно еще можно пройтись по UDP портам, но такое встречается очень редко

2. Что можно делать с найденными сервисами.
Тут опишу самое распространенное, что может быть. ( порты указаны общепринятые, хотя не факт, что сервис обязано будет на нем, а не на другом )

###### 21 - FTP

Первое что, стоит попробовать - анонимный доступ. ( Предполагается, что вы знаете как подключиться к FTP и как с ним взаимодействовать )
```
anonymous:anonymous
anonymous:
ftp:ftp
anonymous:anon@test.ru # что-то похожее на почту для пароля
```

Также можно попробовать какие-нибудь дефолтные креды - admin:admin.
Если известен пользователь на машине то можно побрутить пароль. Есть куча словарей разных, можно использовать как rockyou.txt ( хотя он очень большой), так например что-то из SecLists например -  [раз](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/default-passwords.txt) [два](https://github.com/danielmiessler/SecLists/blob/master/Passwords/Default-Credentials/ftp-betterdefaultpasslist.txt).  

``` bash
hydra -L usernames.txt -P passwords.txt ftp://10.10.0.50 -t <num> -s <port> # подбор  к разным юзерам разные пароли

hydra -l <username> -P passwords.txt ftp://10.10.0.50 -t <num> -s <port> # подбор к пользователю <user> разные пароли
```

Подробнее по ключам в help'e по hydra

###### 22 - SSH

Брутфорс паролей к пользователям, можно попробовать к root подобрать дефолтные пароли, а также к пользователям, которые есть на машине ( если откуда-то узнали)

``` bash
hydra -L user.txt -P pass.txt <ip> ssh -t <num>
hydra -l root -P pass.txt <ip> ssh -t <num>
```

###### 80/443 - HTTP

Тут можно описывать очень много, все очень зависит от конкретного приложения. Первым делом обращаем внимание на версию сервера и смотрим есть ли на нее уязвимости.

Если это кастомное приложение:

Изучаем функционал приложения желательно через BurpSuite, чтобы видеть какие запросы к приложению ходят и за что они отвечают. Затем можно пофаззить директории/файлы если сходу ничего интересного. Для этого есть разные утилиты: ffuf, gobuster, dirbuster и т.д и разные словари для фазза. Можно прогнать эти три: [fuzz.txt](https://github.com/Bo0oM/fuzz.txt/blob/master/fuzz.txt)[raft-small-directories-lowercase.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-small-directories-lowercase.txt) и [raft-small-files-lowercase.txt](https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-small-directories-lowercase.txt)

Если есть форма логина --> пробуем дефолтные креды (admin:admin и прочее), пробуем подбор пароля к admin'у например. Можно попробовать запустить sqlmap поискать скули. Потенциально надо искать, то что может привести к RCE - fileUpload, OScommandInjection, SQLi, SSTI и другие. 

Если это какая-то CMS или известная система:

Ищем дефолтные учетки, например для Apache Tomcat - (tomcat:tomcat).

Для CMS'ок по типу WordPress есть утилиты вроде [wpscan](https://github.com/wpscanteam/wpscan), [cmseek](https://www.kali.org/tools/cmseek/) . Остальное также - дефолтные креды + проверка версии. Для проверки WordPress есть интересная статейка - [WPhacktricks](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress)

3. Если получилось пробиться на машину
Например вы нашли RCE в вебе --> надо прокинуть себе reverseShell сгенерировать можно [здесь](https://www.revshells.com/) (указываете свои IP + port, справа будет то как можно это соединение ловить)

Первым делом надо проверить кто есть на хосте кроме вас это команда - `w` или `who`. Затем если позволяют права нужно выкинуть другого человека с машины как это сделать можно посмотреть [здесь](https://stackpointer.io/unix/unix-linux-kick-user-off-ssh/627/) Если права не позволяют, то смотрим можем ли положить файлик index.html в корень веб-приложения, если нет, то ищем способы повышения привилегий.

Методы закрепления в системе Linux:

1. Сгенерировать ключи ssh и закинуть их на хост, чтобы иметь доступ.
2. Создать нового пользователя с привилегиями root под которым в случае чего вы сможете зайти

И соответственно нужно понимать, что другие команды преследуют те-же цели. Значит нужно периодически смотреть появляется ли кто-то на машине или нет. Если появляются, то как они это делают ( искать их back door'ы и удалять их ).

P.S Если встречается что-то неизвестное то нужно все гуглить, хороший сайт https://book.hacktricks.xyz/welcome/readme но им все не ограничивается. Например увидели неизвестный сервис, ищем как его можно взломать. 

